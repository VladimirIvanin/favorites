/*!
 * favorites v0.2.0
 * https://github.com/VladimirIvanin/favorites/
 */
var Favorites=function(e){function t(e){delete installedChunks[e]}function n(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.src=p.p+""+e+"."+E+".hot-update.js",t.appendChild(n)}function o(){return new Promise(function(e,t){if("undefined"==typeof XMLHttpRequest)return t(new Error("No browser support"));try{var n=new XMLHttpRequest,o=p.p+""+E+".hot-update.json";n.open("GET",o,!0),n.timeout=1e4,n.send(null)}catch(e){return t(e)}n.onreadystatechange=function(){if(4===n.readyState)if(0===n.status)t(new Error("Manifest request to "+o+" timed out."));else if(404===n.status)e();else if(200!==n.status&&304!==n.status)t(new Error("Manifest request to "+o+" failed."));else{try{var r=JSON.parse(n.responseText)}catch(e){return void t(e)}e(r)}}})}function r(e){var t=F[e];if(!t)return p;var n=function(n){return t.hot.active?(F[n]?F[n].parents.indexOf(e)<0&&F[n].parents.push(e):(j=[e],h=n),t.children.indexOf(n)<0&&t.children.push(n)):(console.warn("[HMR] unexpected require("+n+") from disposed module "+e),j=[]),p(n)};for(var o in p)Object.prototype.hasOwnProperty.call(p,o)&&"e"!==o&&Object.defineProperty(n,o,function(e){return{configurable:!0,enumerable:!0,get:function(){return p[e]},set:function(t){p[e]=t}}}(o));return n.e=function(e){function t(){A--,"prepare"===O&&(T[e]||u(e),0===A&&0===w&&l())}return"ready"===O&&i("prepare"),A++,p.e(e).then(t,function(e){throw t(),e})},n}function s(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:h!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var o=0;o<e.length;o++)t._acceptedDependencies[e[o]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:d,apply:f,status:function(e){if(!e)return O;_.push(e)},addStatusHandler:function(e){_.push(e)},removeStatusHandler:function(e){var t=_.indexOf(e);t>=0&&_.splice(t,1)},data:P[e]};return h=void 0,t}function i(e){O=e;for(var t=0;t<_.length;t++)_[t].call(null,e)}function a(e){return+e+""===e?+e:e}function d(e){if("idle"!==O)throw new Error("check() is only allowed in idle status");return b=e,i("check"),o().then(function(e){if(!e)return i("idle"),null;$={},T={},M=e.c,g=e.h,i("prepare");var t=new Promise(function(e,t){m={resolve:e,reject:t}});y={};return u(0),"prepare"===O&&0===A&&0===w&&l(),t})}function c(e,t){if(M[e]&&$[e]){$[e]=!1;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(y[n]=t[n]);0==--w&&0===A&&l()}}function u(e){M[e]?($[e]=!0,w++,n(e)):T[e]=!0}function l(){i("ready");var e=m;if(m=null,e)if(b)f(b).then(function(t){e.resolve(t)},function(t){e.reject(t)});else{var t=[];for(var n in y)Object.prototype.hasOwnProperty.call(y,n)&&t.push(a(n));e.resolve(t)}}function f(n){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];e.indexOf(o)<0&&e.push(o)}}if("ready"!==O)throw new Error("apply() is only allowed in ready status");n=n||{};var r,s,d,c,u,l={},f=[],v={},h=function(){console.warn("[HMR] unexpected require("+b.moduleId+") to disposed module")};for(var m in y)if(Object.prototype.hasOwnProperty.call(y,m)){u=a(m);var b;b=y[m]?function(e){for(var t=[e],n={},r=t.slice().map(function(e){return{chain:[e],id:e}});r.length>0;){var s=r.pop(),i=s.id,a=s.chain;if((c=F[i])&&!c.hot._selfAccepted){if(c.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:i};if(c.hot._main)return{type:"unaccepted",chain:a,moduleId:i};for(var d=0;d<c.parents.length;d++){var u=c.parents[d],l=F[u];if(l){if(l.hot._declinedDependencies[i])return{type:"declined",chain:a.concat([u]),moduleId:i,parentId:u};t.indexOf(u)>=0||(l.hot._acceptedDependencies[i]?(n[u]||(n[u]=[]),o(n[u],[i])):(delete n[u],t.push(u),r.push({chain:a.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}(u):{type:"disposed",moduleId:m};var I=!1,_=!1,w=!1,A="";switch(b.chain&&(A="\nUpdate propagation: "+b.chain.join(" -> ")),b.type){case"self-declined":n.onDeclined&&n.onDeclined(b),n.ignoreDeclined||(I=new Error("Aborted because of self decline: "+b.moduleId+A));break;case"declined":n.onDeclined&&n.onDeclined(b),n.ignoreDeclined||(I=new Error("Aborted because of declined dependency: "+b.moduleId+" in "+b.parentId+A));break;case"unaccepted":n.onUnaccepted&&n.onUnaccepted(b),n.ignoreUnaccepted||(I=new Error("Aborted because "+u+" is not accepted"+A));break;case"accepted":n.onAccepted&&n.onAccepted(b),_=!0;break;case"disposed":n.onDisposed&&n.onDisposed(b),w=!0;break;default:throw new Error("Unexception type "+b.type)}if(I)return i("abort"),Promise.reject(I);if(_){v[u]=y[u],o(f,b.outdatedModules);for(u in b.outdatedDependencies)Object.prototype.hasOwnProperty.call(b.outdatedDependencies,u)&&(l[u]||(l[u]=[]),o(l[u],b.outdatedDependencies[u]))}w&&(o(f,[b.moduleId]),v[u]=h)}var T=[];for(s=0;s<f.length;s++)u=f[s],F[u]&&F[u].hot._selfAccepted&&T.push({module:u,errorHandler:F[u].hot._selfAccepted});i("dispose"),Object.keys(M).forEach(function(e){!1===M[e]&&t(e)});for(var $,x=f.slice();x.length>0;)if(u=x.pop(),c=F[u]){var D={},S=c.hot._disposeHandlers;for(d=0;d<S.length;d++)(r=S[d])(D);for(P[u]=D,c.hot.active=!1,delete F[u],d=0;d<c.children.length;d++){var k=F[c.children[d]];k&&(($=k.parents.indexOf(u))>=0&&k.parents.splice($,1))}}var H,C;for(u in l)if(Object.prototype.hasOwnProperty.call(l,u)&&(c=F[u]))for(C=l[u],d=0;d<C.length;d++)H=C[d],($=c.children.indexOf(H))>=0&&c.children.splice($,1);i("apply"),E=g;for(u in v)Object.prototype.hasOwnProperty.call(v,u)&&(e[u]=v[u]);var L=null;for(u in l)if(Object.prototype.hasOwnProperty.call(l,u)){c=F[u],C=l[u];var N=[];for(s=0;s<C.length;s++)H=C[s],r=c.hot._acceptedDependencies[H],N.indexOf(r)>=0||N.push(r);for(s=0;s<N.length;s++){r=N[s];try{r(C)}catch(e){n.onErrored&&n.onErrored({type:"accept-errored",moduleId:u,dependencyId:C[s],error:e}),n.ignoreErrored||L||(L=e)}}}for(s=0;s<T.length;s++){var U=T[s];u=U.module,j=[u];try{p(u)}catch(e){if("function"==typeof U.errorHandler)try{U.errorHandler(e)}catch(t){n.onErrored&&n.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:t,orginalError:e}),n.ignoreErrored||L||(L=t),L||(L=e)}else n.onErrored&&n.onErrored({type:"self-accept-errored",moduleId:u,error:e}),n.ignoreErrored||L||(L=e)}}return L?(i("fail"),Promise.reject(L)):(i("idle"),new Promise(function(e){e(f)}))}function p(t){if(F[t])return F[t].exports;var n=F[t]={i:t,l:!1,exports:{},hot:s(t),parents:(I=j,j=[],I),children:[]};return e[t].call(n.exports,n,n.exports,r(t)),n.l=!0,n.exports}var v=this.webpackHotUpdateFavorites;this.webpackHotUpdateFavorites=function(e,t){c(e,t),v&&v(e,t)};var h,m,y,g,b=!0,E="1ec5f1725723fa417246",P={},j=[],I=[],_=[],O="idle",w=0,A=0,T={},$={},M={},F={};return p.m=e,p.c=F,p.i=function(e){return e},p.d=function(e,t,n){p.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},p.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return p.d(t,"a",t),t},p.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},p.p="",p.h=function(){return E},r(8)(p.s=8)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.defaults={counterTemplate:"(%c%)",counterTemplateEmpty:null,buttonNotAddedText:null,buttonAddedText:null,productsListTemplate:function(){},variantsListTemplate:function(){},debug:!1,onFilled:function(){},onEmpty:function(){},onAdd:function(){},onRemove:function(){},onInit:function(){},onBefore:function(){},onUpdate:function(){},replaceTitle:!0,titles:{added:"Добавлен в избранное",notAdded:"Добавить в избранное"},classes:{added:"is-added",notAdded:"not-added",empty:"is-empty",filled:"is-filled"}},t.system={keyProducts:"favorites_products",keyFavorites:"favorites_data"},t.systemEvents={filled:"filled:insales:favorites",empty:"empty:insales:favorites",add:"add:insales:favorites",remove:"remove:insales:favorites",init:"init:insales:favorites",before:"before:insales:favorites",update:"update:insales:favorites"},t.systemSelectors={add:"data-favorites-add",addParam:"favorites-add",addVariant:"data-favorites-variant-add",addVariantParam:"favorites-variant-add",addVariantProduct:"data-favorites-variant-product",addVariantProductParam:"favorites-variant-product",remove:"data-favorites-remove",removeParam:"favorites-remove",counter:"data-favorites-counter",counterParam:"favorites-counter",trigger:"data-favorites-trigger",triggerParam:"favorites-trigger"}},function(e,t,n){"use strict";"use strict;";function o(e,t){var n=this,o=c(e,n.productIds,t,n.options.classes.added,n.options.classes.notAdded);if(o.isActive||!o.notAdded){n.productIds=u(n.productIds,t),n.productIds=h(n.productIds);var r=s(e);r&&(n.variantIds=u(n.variantIds,r),n.variantIds=h(n.variantIds)),n.setFavorites({products:n.productIds,variants:n.variantIds}),a(e,n,t),n.getProductList(n.productIds).done(function(t){n.products=t||{},n.variants=(0,v.getVariants)(t,n.variantIds)||{},n.eventMachine(p.systemEvents.remove,e),0==n.variantIds.length&&n.eventMachine(p.systemEvents.empty,null),n.eventMachine(p.systemEvents.update,e)}).fail(function(){n.products={},n.variants={},n.eventMachine(p.systemEvents.remove,e),0==n.variantIds.length&&n.eventMachine(p.systemEvents.empty,null),n.eventMachine(p.systemEvents.update,e)})}}function r(e,t){var n=this,o=c(e,n.productIds,t,n.options.classes.added,n.options.classes.notAdded);if(!o.isActive||!o.isAdded){n.productIds.push(t),n.productIds=h(n.productIds);var r=s(e);r&&(n.variantIds.push(r),n.variantIds=h(n.variantIds)),n.setFavorites({products:n.productIds,variants:n.variantIds}),a(e,n,t),n.getProductList(n.productIds).done(function(t){n.products=t||{},n.variants=(0,v.getVariants)(t,n.variantIds)||{},n.eventMachine(p.systemEvents.add,e),n.eventMachine(p.systemEvents.update,e)})}}function s(e){var t=!1,n=e.parents("form:first"),o=e.parents("[data-product-id]:first"),r=o.find('[name="variant_id"]');return r.length>0?t=f(r.val()):(r=n.find('[name="variant_id"]'),r.length>0&&(t=f(r.val()))),t}function i(){var e=this;$("["+p.systemSelectors.trigger+"]").each(function(t,n){a($(this),e,$(this).data(p.systemSelectors.triggerParam))}),$("["+p.systemSelectors.add+"]").each(function(t,n){a($(this),e,$(this).data(p.systemSelectors.addParam))}),$("["+p.systemSelectors.remove+"]").each(function(t,n){a($(this),e,$(this).data(p.systemSelectors.removeParam))})}function a(e,t,n){var o=c(e,t.productIds,n,t.options.classes.added,t.options.classes.notAdded);o.isActive&&(e.removeClass(t.options.classes.notAdded),t.options.replaceTitle&&e.attr("title",t.options.titles.added),o.isAdded||e.addClass(t.options.classes.added),t.options.buttonNotAddedText&&d(t,e,o.isActive)),o.isActive||(e.removeClass(t.options.classes.added),t.options.replaceTitle&&e.attr("title",t.options.titles.notAdded),o.notAdded||e.addClass(t.options.classes.notAdded),t.options.buttonNotAddedText&&d(t,e,o.isActive))}function d(e,t,n){if(n){var o=e.options.buttonAddedText||e.options.buttonNotAddedText;t.html(o)}else{var o=e.options.buttonNotAddedText||"";t.html(o)}}function c(e,t,n,o,r){return{isActive:t.indexOf(n)>-1,isAdded:e.hasClass(o),notAdded:e.hasClass(r)}}function u(e,t){var n=e.indexOf(t);return n>-1&&e.splice(n,1),e}function l(e){return Number(e)===e&&e%1!=0}function f(e){var t=isNaN(+e)?1:+e;return l(t)?t.toFixed(0):t}Object.defineProperty(t,"__esModule",{value:!0}),t.removeToFavorites=o,t.addToFavorites=r,t.checkFavoritesProducts=i,t.getStatusProduct=c;var p=n(0),v=n(2),h=function(e){for(var t=[],n=0;n<e.length;n++)-1==t.indexOf(e[n])&&t.push(e[n]);return t}},function(e,t,n){"use strict";function o(e){var t=this;return $.when(function(){var n=jQuery.Deferred(),o="[object Array]"==Object.prototype.toString.call(e),r={};return o||(t.logger("Список id, не является массивом",e),n.reject(r)),o&&0==e.length&&(t.logger("Список id пуст",e),n.reject(r)),o&&e.length>0&&("object"==("undefined"==typeof Products?"undefined":i(Products))&&Products.getList?Products.getList(e).done(function(e){var o=s(e);Object.keys(o).length>0?(t.logger("Товары из апи common js: ",o),n.resolve(o)):n.reject({})}).fail(function(e){n.reject({})}):c(t,a.system.keyProducts).done(function(o){var r=[];$.each(e,function(e,t){o[t]||r.push(t)}),r.length>0?u(t,r).done(function(e){t.logger("Товары из стандартного апи: ",e),n.resolve($.extend(!0,{},o,e))}).fail(function(e){n.reject({})}):n.resolve(o)}).fail(function(){u(t,e).done(function(e){Object.keys(e).length>0?(d(t,a.system.keyProducts,e),t.logger("Товары из стандартного апи: ",e),n.resolve(s(e))):n.reject({})}).fail(function(e){n.reject({})})})),n.promise()}())}function r(e,t){var n={};return $.each(t,function(t,o){$.each(e,function(e,t){$.each(t.variants,function(e,r){o==r.id&&(n[o]=r,n[o].product=t)})})}),n}function s(e){var t={};return $.each(e,function(e,n){t[n.id]=n}),t}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.getProductList=o,t.getVariants=r,t.convertProductList=s;var a=n(0),d=function(e,t,n){localforage.setItem(t,n,function(t){t?e.logger("Не удалось сохранить товары в localforage"):e.logger("Данные сохранены в localforage")})},c=function(e,t){return $.when(function(){var n=jQuery.Deferred();return localforage.getItem(t,function(t,o){o?(e.logger("Данные получены из хранилища",o),n.resolve(s(o))):(e.logger("Хранилище пусто"),n.reject("Хранилище пусто"))}),n.promise()}())},u=function(e,t){return $.when(function(t){var n=jQuery.Deferred();return $.post("/products_by_id/"+t.join(",")+".json").done(function(t){e.logger("Товары из апи: ",t),n.resolve(s(t))}).fail(function(e){n.resolve({})}),n.promise()}(t))}},function(e,t,n){"use strict";function o(){var e=this;$(document).on("click",r(s.systemSelectors.trigger),function(t){t.preventDefault(),e.eventMachine(s.systemEvents.before,$(this));var n=$(this).data(s.systemSelectors.triggerParam);e.productIds.indexOf(n)>-1?(e.logger("removeToFavorites"),e.removeToFavorites($(this),n)):(e.logger("addToFavorites"),e.addToFavorites($(this),n))}),$(document).on("click",r(s.systemSelectors.add),function(t){t.preventDefault(),e.eventMachine(s.systemEvents.before,$(this));var n=$(this).data(s.systemSelectors.addParam);e.addToFavorites($(this),n)}),$(document).on("click",r(s.systemSelectors.remove),function(t){t.preventDefault(),e.eventMachine(s.systemEvents.before,$(this));var n=$(this).data(s.systemSelectors.removeParam);e.removeToFavorites($(this),n)}),$(document).on(s.systemEvents.update,function(t){e.options.productsListTemplate(t.insalesFavorites.products),e.options.variantsListTemplate(t.insalesFavorites.variants)}),$(document).on(s.systemEvents.update,function(t){var n=e.options.counterTemplate;0==e.productIds.length&&(n=e.options.counterTemplateEmpty||e.options.counterTemplate);var o=n.replace("%c%",e.productIds.length),i=$(r(s.systemSelectors.counter));i.html(o),0==e.productIds.length?i.addClass(e.options.classes.empty).removeClass(e.options.classes.filled):i.removeClass(e.options.classes.empty).addClass(e.options.classes.filled)})}function r(e,t){return"["+(t?e+'="'+t+'"':e)+"]"}Object.defineProperty(t,"__esModule",{value:!0}),t.bindTrigger=o;var s=n(0);n(1)},function(e,t,n){"use strict";function o(e,t){var n=this,o={};o.products=n.products||{},o.variants=n.variants||{},o.$target=t||null,"object"==("undefined"==typeof EventBus?"undefined":s(EventBus))&&EventBus.publish&&EventBus.publish(e,o);var i=jQuery.Event(e);i.insalesFavorites=o,$(document).trigger(i);var a=r(n,e);n.options[a]&&"function"==typeof n.options[a]&&n.options[a](o)}function r(e,t){var n="";return $.each(i.systemEvents,function(e,o){o===t&&(n="on"+a(e))}),n}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=o;var i=n(0),a=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}},function(e,t,n){"use strict";"use strict;";function o(){var e=this;return $.when(function(){var t=jQuery.Deferred();return localforage.getItem(s.system.keyFavorites,function(n,o){o?(e.logger("Данные получены из хранилища",o),t.resolve(o)):(e.logger("Хранилище пусто"),t.reject({}))}),t.promise()}())}function r(e){var t=this;localforage.setItem(s.system.keyFavorites,e,function(e){e?t.logger("Не удалось сохранить избранное в localforage"):t.logger("Данные сохранены в localforage")})}Object.defineProperty(t,"__esModule",{value:!0}),t.getFavorites=o,t.setFavorites=r;var s=n(0)},function(e,t,n){"use strict";function o(e){void 0===window.localforage?(console.warn("Не подключен плагин localforage!"),r("https://cdnjs.cloudflare.com/ajax/libs/localforage/1.5.0/localforage.min.js",function(){e()})):e()}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var r=function(e){function t(e){throw new URIError("The script "+e.target.src+" is not accessible.")}return function(n,o){var r=document.createElement("script");r.type="text/javascript",r.onerror=t,o&&(r.onload=o),e.appendChild(r),r.src=n}}(document.head||document.getElementsByTagName("head")[0])},function(e,t,n){"use strict";function o(e,t){this.options.debug&&(console.info("==favorites=="),console.log(e),t&&console.log(t),console.log("///////////////////"),console.log("///favorites//////"),console.log("/////////////////"))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=n(0),i=n(2),a=n(1),d=n(3),c=n(5),u=n(6),l=o(u),f=n(7),p=o(f),v=n(4),h=o(v),m=function e(t){r(this,e);var n=this;this.options=$.extend(!0,{},s.defaults,t),this.system=s.system,this.productIds=[],this.variantIds=[],this.products={},this.variants={},this.logger=p.default,this.getProductList=i.getProductList,this.getFavorites=c.getFavorites,this.setFavorites=c.setFavorites,this.bindTrigger=d.bindTrigger,this.eventMachine=h.default,this.checkFavoritesProducts=a.checkFavoritesProducts,this.addToFavorites=a.addToFavorites,this.removeToFavorites=a.removeToFavorites,(0,l.default)(function(){n.getFavorites().done(function(e){n.productIds=e.products||[],n.variantIds=e.variants||[],n.bindTrigger(),n.checkFavoritesProducts(),n.getProductList(e.products).done(function(t){n.products=t||{},n.variants=(0,i.getVariants)(t,e.variants)||{},n.eventMachine(s.systemEvents.filled,null),n.eventMachine(s.systemEvents.init,null),n.eventMachine(s.systemEvents.update,null)}).fail(function(){n.eventMachine(s.systemEvents.empty,null),n.eventMachine(s.systemEvents.init,null),n.eventMachine(s.systemEvents.update,null)})}).fail(function(){n.bindTrigger(),n.checkFavoritesProducts(),n.eventMachine(s.systemEvents.empty,null),n.eventMachine(s.systemEvents.init,null),n.eventMachine(s.systemEvents.update,null)})})};e.exports=m}]);